<!doctype html>
<!--suppress HtmlUnknownAttribute, XmlUnboundNsPrefix -->
<html>
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Demo: Train Best Price Calendar</title>

    <link rel="stylesheet" href="/webjars/reveal.js/3.4.1/css/reveal.css">
    <link rel="stylesheet" href="/webjars/reveal.js/3.4.1/css/theme/white.css">
    <link rel="stylesheet" href="/webjars/reveal.js/3.4.1/lib/css/zenburn.css">

    <script src="/webjars/reveal.js/3.4.1/lib/js/head.min.js"></script>
    <script src="/webjars/reveal.js/3.4.1/js/reveal.js"></script>
    <script src="/webjars/vue/2.2.1/dist/vue.min.js"></script>

    <style>
        td.fail {
            background-color: orangered;
        }

        td.pass {
            background-color: lightgreen;
        }
    </style>

</head>
<body>

<div class="reveal">

    <div id="app" class="slides">

        <section v-for="query in queries">
            <h4><a v-bind:href="query.url" target="_blank">{{query.url}}</a></h4>
            <table>
                <tr>
                    <th>Date</th>
                    <th>Price</th>
                    <th>Seats</th>
                </tr>
                <tr v-for="bestPrice in query.bestPrices">
                    <td>{{bestPrice.date}}</td>
                    <td v-if="bestPrice.price == bestPrice.computedPrice" class="pass">{{bestPrice.price}}</td>
                    <td v-else class="fail">"{{bestPrice.computedPrice}}" != {{bestPrice.price}}</td>
                    <td v-if="bestPrice.seats == bestPrice.computedSeats" class="pass">{{bestPrice.seats}}</td>
                    <td v-else class="fail">"{{bestPrice.computedSeats}}" != {{bestPrice.seats}}</td>
                </tr>
            </table>
        </section>

    </div>

</div>

<script>

    var app = new Vue({
        el: '#app',
        data: {
            queries: [{
                url: "/FRPAR/GBLON/3001-01-01/3001-01-07?seats=1",
                bestPrices: [
                    {date: "3001-01-01", price: "157", computedPrice: "", seats: "3", computedSeats: ""},
                    {date: "3001-01-02", price: "142", computedPrice: "", seats: "3", computedSeats: ""},
                    {date: "3001-01-03", price: "168", computedPrice: "", seats: "1", computedSeats: ""},
                    {date: "3001-01-04", price: "168", computedPrice: "", seats: "1", computedSeats: ""},
                    {date: "3001-01-05", price: "142", computedPrice: "", seats: "3", computedSeats: ""},
                    {date: "3001-01-06", price: "157", computedPrice: "", seats: "3", computedSeats: ""},
                    {date: "3001-01-07", price: "152", computedPrice: "", seats: "3", computedSeats: ""}
                ]
            }, {
                url: "/FRPAR/GBLON/3001-03-11/3001-03-17?seats=2",
                bestPrices: [
                    {date: "3001-03-11", price: "100", computedPrice: "", seats: "2", computedSeats: ""},
                    {date: "3001-03-12", price: "105", computedPrice: "", seats: "2", computedSeats: ""},
                    {date: "3001-03-13", price: "90", computedPrice: "", seats: "2", computedSeats: ""},
                    {date: "3001-03-14", price: "156", computedPrice: "", seats: "4", computedSeats: ""},
                    {date: "3001-03-15", price: "156", computedPrice: "", seats: "4", computedSeats: ""},
                    {date: "3001-03-16", price: "90", computedPrice: "", seats: "2", computedSeats: ""},
                    {date: "3001-03-17", price: "105", computedPrice: "", seats: "2", computedSeats: ""}
                ]
            }, {
                url: "/FRPAR/GBLON/3001-12-25/3001-12-31?seats=5",
                bestPrices: [
                    {date: "3001-12-25", price: "222", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-12-26", price: "248", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-12-27", price: "248", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-12-28", price: "222", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-12-29", price: "237", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-12-30", price: "232", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-12-31", price: "237", computedPrice: "", seats: "10", computedSeats: ""}
                ]
            }, {
                url: "/FRMRS/GBCAM/3001-02-28/3001-03-06?seats=5",
                bestPrices: [
                    {date: "3001-02-28", price: "248", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-03-01", price: "206", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-03-02", price: "180", computedPrice: "", seats: "7", computedSeats: ""},
                    {date: "3001-03-03", price: "195", computedPrice: "", seats: "7", computedSeats: ""},
                    {date: "3001-03-04", price: "190", computedPrice: "", seats: "7", computedSeats: ""},
                    {date: "3001-03-05", price: "195", computedPrice: "", seats: "7", computedSeats: ""},
                    {date: "3001-03-06", price: "180", computedPrice: "", seats: "7", computedSeats: ""}
                ]
            }, {
                url: "/GBOXF/FRLIL/3001-07-31/3001-08-06?seats=7",
                bestPrices: [
                    {date: "3001-07-31", price: "197", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-08-01", price: "223", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-08-02", price: "223", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-08-03", price: "197", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-08-04", price: "212", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-08-05", price: "207", computedPrice: "", seats: "10", computedSeats: ""},
                    {date: "3001-08-06", price: "212", computedPrice: "", seats: "10", computedSeats: ""}
                ]
            }]
        }
    });

    var promises = [];

    app.queries.forEach(function (query) {

        var promise = fetch(query.url)
            .then(function (response) {
                return response.json();
            })
            .then(function (computedBestPrices) {
                computedBestPrices.forEach(function (computedBestPrice) {
                    var bestPrice = query.bestPrices.find(function (candidate) {
                        return computedBestPrice.date == candidate.date;
                    });
                    if (bestPrice !== undefined) {
                        bestPrice.computedPrice = computedBestPrice.price;
                        bestPrice.computedSeats = computedBestPrice.seats;
                    }
                });

            });

        promises.push(promise);

    });

    Promise.all(promises).then(function () {
        // initialize reveal slides only when all queries are resolved
        Reveal.initialize({history: true, hideAddressBar: true});
    });

</script>

</body>
</html>
